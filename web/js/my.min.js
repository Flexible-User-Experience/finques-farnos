"use strict";angular.module("propertiesApp",["ngCookies","ngResource","ngSanitize","ngRoute","truncate","checklist-model","nemLogging","uiGmapgoogle-maps"]).config(["$interpolateProvider",function(e){e.startSymbol("[["),e.endSymbol("]]")}]).config(function(e){e.configure({key:"AIzaSyB332MhD5g142kIo79ZagVcXUidQwHbWwk",v:"3.23",language:"es",libraries:"drawing,geometry,visualization"})}).constant("CFG",{DELAY:600,RANGE_STEPS:20}),angular.module("propertiesApp").service("API",["CFG","$http","$q","$log",function(e,o,r,t){this.getProperties=function(e){var i=r.defer();return o.get(Routing.generate("api_properties_api_filtered",{categories:e.getSerializedCategories(),type:e.type,city:e.city,area:e.area,rooms:e.rooms,price:e.price,_format:"json"})).success(function(o){e.properties=o,i.resolve(o)}).error(function(e){t.error("[API.getProperties]",e),i.reject(e)}),e.type>0&&o.get(Routing.generate("api_get_api_cities_by_type",{type:e.type,_format:"json"})).success(function(o){e.form.cities=o,i.resolve(o)}).error(function(e){t.error("[API.getProperties - on selected type changed]",e),i.reject(e)}),i.promise}}]),angular.module("propertiesApp").controller("PropertyDetailCtrl",["CFG","uiGmapGoogleMapApi","$scope","$log",function(e,o,r,t){r.init=function(e){r.localization=angular.fromJson(e),r.map={zoom:16,radius:r.localization.radius,stroke:{color:"#D86F24",weight:1,opacity:1},fill:{color:"#D86F24",opacity:.25},center:{latitude:r.localization.coords.latitude,longitude:r.localization.coords.longitude}},r.map.options={scrollwheel:!1,draggable:!0,maxZoom:20},r.map.control={}},o.then(function(e){t.log(e)})}]),angular.module("propertiesApp").controller("MainCtrl",["CFG","API","uiGmapGoogleMapApi","$scope","$timeout","$log",function(e,o,r,t,i,n){var a,c,l=!1;numeral.language("es"),t.init=function(e,o,r){t.map={center:{latitude:41,longitude:0},zoom:4,bounds:{},clusterOptions:{gridSize:80,maxZoom:20,averageCenter:!0,minimumClusterSize:1,zoomOnClick:!1}},t.map.options={scrollwheel:!0,draggable:!0,maxZoom:15},t.map.control={},t.form=angular.fromJson(e),t.selectedPropertiesFormFilter=angular.fromJson(o),t.properties=angular.fromJson(r),t.form.area.max=10*Math.floor(t.form.area.max/10),t.form.price.max=1e3*Math.floor(t.form.price.max/1e3),t.categories=[],0===t.selectedPropertiesFormFilter[0].length?t.categories=[]:angular.forEach(t.selectedPropertiesFormFilter[0],function(e){t.categories.push(parseInt(e))}),t.type=t.selectedPropertiesFormFilter[1],t.city=t.selectedPropertiesFormFilter[2],t.area=t.selectedPropertiesFormFilter[3],t.rooms=t.selectedPropertiesFormFilter[4],t.price=t.selectedPropertiesFormFilter[5]},r.then(function(e){n.log(e)}),t.formListener=function(){o.getProperties(t)},t.$watch("area",function(r,n){a&&i.cancel(a),a=i(function(){void 0!==r&&void 0!==n&&r!==n&&o.getProperties(t)},e.DELAY)}),t.$watch("rooms",function(r,n){c&&i.cancel(c),c=i(function(){void 0!==r&&void 0!==n&&r!==n&&o.getProperties(t)},e.DELAY)}),t.$watch("price",function(r,n){l&&i.cancel(l),l=i(function(){void 0!==r&&void 0!==n&&r!==n&&o.getProperties(t)},e.DELAY)}),t.getCurrency=function(e){return void 0!==e?numeral(e).format("0,0"):""},t.getUrlPropertyDetail=function(e){return Routing.generate("front_property",{type:e.type_name_slug,city:e.city_name_slug,name:e.name_slug,reference:e.reference})},t.getSerializedCategories=function(){var e="";return angular.forEach(t.categories,function(o){e=e+o+"-"},e),e=""===e?"-1":e.slice(0,-1)}}]);