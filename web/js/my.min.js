"use strict";angular.module("propertiesApp",["ngCookies","ngResource","ngSanitize","ngRoute","uiGmapgoogle-maps","vr.directives.slider"]).config(["$interpolateProvider",function(e){e.startSymbol("[["),e.endSymbol("]]")}]).config(function(e){e.configure({key:"AIzaSyB332MhD5g142kIo79ZagVcXUidQwHbWwk",v:"3.17",language:"es",sensor:!1,libraries:"drawing,geometry,visualization"})}).constant("CFG",{DELAY:600,RANGE_STEPS:20}),angular.module("propertiesApp").controller("MainCtrl",["CFG","API","uiGmapGoogleMapApi","$scope","$timeout","$routeParams","$log",function(e,r,o,t,i,n,a){numeral.language("es");var m,s,p=!1;t.firstCallFinished=!1,t.type={},t.map={center:{latitude:41,longitude:0},zoom:4,bounds:{},clusterOptions:{gridSize:80,maxZoom:20,averageCenter:!0,minimumClusterSize:1,zoomOnClick:!1}},t.map.options={scrollwheel:!0,draggable:!0,maxZoom:15},t.map.control={},o.then(function(e){a.log(e)});var c=r.getPropertiesFormFilters(t);c.then(function(){t.map.control.refresh();var e=r.getProperties(t);e.then(function(){t.firstCallFinished=!0},function(e){a.error("get properties promise error",e)})},function(e){a.error("get properties form filters promise error",e)}),t.formListener=function(){r.getProperties(t)},t.$watch("area",function(o,n){m&&i.cancel(m),m=i(function(){void 0!==o&&void 0!==n&&r.getProperties(t)},e.DELAY)}),t.$watch("rooms",function(o,n){s&&i.cancel(s),s=i(function(){void 0!==o&&void 0!==n&&r.getProperties(t)},e.DELAY)}),t.$watch("price",function(o,n){p&&i.cancel(p),p=i(function(){void 0!==o&&void 0!==n&&r.getProperties(t)},e.DELAY)}),t.getCurrency=function(e){return void 0!==e?numeral(e).format("0,0"):""},t.getUrlPropertyDetail=function(e){return Routing.generate("front_property",{type:e.type_name_slug,name:e.name_slug})}}]),angular.module("propertiesApp").service("API",["CFG","$http","$q","$log",function(e,r,o,t){this.getPropertiesFormFilters=function(i){var n=o.defer();return r.get(Routing.generate("api_properties_api_form_filter",{_format:"json"})).success(function(r){t.log("getPropertiesFormFilters",r),i.form=r,i.form.area.min=10*Math.ceil(i.form.area.min/10),i.form.area.max=10*Math.floor(i.form.area.max/10),i.form.area.step=Math.round((i.form.area.max-i.form.area.min)/e.RANGE_STEPS),i.form.price.min=1e3*Math.ceil(i.form.price.min/1e3),i.form.price.max=1e3*Math.floor(i.form.price.max/1e3),i.form.price.step=Math.round((i.form.price.max-i.form.price.min)/e.RANGE_STEPS),i.area=i.form.area.max,i.rooms=i.form.rooms.min,i.price=i.form.price.min,i.type=i.form.types[0],n.resolve(r)}).error(function(e){t.error("getPropertiesFormFilters",e),n.reject(e)}),n.promise},this.getProperties=function(e){var i=o.defer();return r.get(Routing.generate("api_properties_api_filtered",{type:e.type.id,area:e.area,rooms:e.rooms,price:e.price,_format:"json"})).success(function(r){t.log("getProperties",r.length,r),e.properties=r,i.resolve(r)}).error(function(e){t.error("getProperties",e),i.reject(e)}),i.promise}}]);