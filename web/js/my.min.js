"use strict";angular.module("propertiesApp",["ngCookies","ngResource","ngSanitize","ngRoute","truncate","checklist-model","nemLogging","uiGmapgoogle-maps"]).config(["$interpolateProvider",function(e){e.startSymbol("[["),e.endSymbol("]]")}]).config(function(e){e.configure({key:"AIzaSyCpZkgUPZNnkE0MDxFP3Vx6WmDoiMPoJ74",v:"3.35",language:"es",libraries:""})}).constant("CFG",{DELAY:600,RANGE_STEPS:20}),angular.module("propertiesApp").service("API",["CFG","$http","$q","$log",function(e,t,i,n){this.getProperties=function(r){var o=i.defer();return t.get(Routing.generate("api_properties_api_filtered",{categories:r.getSerializedCategories(),type:r.type,city:r.city,area:r.area,rooms:r.rooms,price:r.price,_format:"json"})).success(function(e){r.properties=e,o.resolve(e)}).error(function(e){n.error("[API.getProperties]",e),o.reject(e)}),t.get(Routing.generate("api_get_api_cities_by_type",{type:r.type,_format:"json"})).success(function(e){r.form.cities=e,o.resolve(e)}).error(function(e){n.error("[API.getProperties - on selected type changed]",e),o.reject(e)}),o.promise}}]),angular.module("propertiesApp").controller("PropertyDetailCtrl",["CFG","uiGmapGoogleMapApi","$scope","$log",function(e,r,o,t){o.init=function(e){o.localization=angular.fromJson(e),o.map={zoom:16,radius:o.localization.radius,stroke:{color:"#D86F24",weight:1,opacity:1},fill:{color:"#D86F24",opacity:.25},center:{latitude:o.localization.coords.latitude,longitude:o.localization.coords.longitude}},o.map.options={scrollwheel:!1,draggable:!0,maxZoom:20},o.map.control={}},r.then(function(e){})}]),angular.module("propertiesApp").controller("MainCtrl",["CFG","API","$scope","$timeout",function(o,t,i,n){var a,c,s=!1;numeral.language("es"),i.init=function(e,r,o){i.form=angular.fromJson(e),i.selectedPropertiesFormFilter=angular.fromJson(r),i.properties=angular.fromJson(o),i.form.area.max=10*Math.floor(i.form.area.max/10),i.form.price.max=1e3*Math.floor(i.form.price.max/1e3),i.categories=[],0===i.selectedPropertiesFormFilter[0].length?i.categories=[]:angular.forEach(i.selectedPropertiesFormFilter[0],function(e){i.categories.push(parseInt(e))}),i.type=i.selectedPropertiesFormFilter[1],i.city=i.selectedPropertiesFormFilter[2],i.area=i.form.area.max,i.rooms=i.form.rooms.max,i.price=0},i.formListener=function(){t.getProperties(i)},i.$watch("area",function(e,r){a&&n.cancel(a),a=n(function(){void 0!==e&&void 0!==r&&e!==r&&t.getProperties(i)},o.DELAY)}),i.$watch("rooms",function(e,r){c&&n.cancel(c),c=n(function(){void 0!==e&&void 0!==r&&e!==r&&t.getProperties(i)},o.DELAY)}),i.$watch("price",function(e,r){s&&n.cancel(s),s=n(function(){void 0!==e&&void 0!==r&&e!==r&&t.getProperties(i)},o.DELAY)}),i.getCurrency=function(e){return void 0!==e?numeral(e).format("0,0"):""},i.getUrlPropertyDetail=function(e){return Routing.generate("front_property",{type:e.type_name_slug,city:e.city_name_slug,name:e.name_slug,reference:e.reference})},i.getSerializedCategories=function(){var r="";return angular.forEach(i.categories,function(e){r=r+e+"-"},r),r=""===r?"-1":r.slice(0,-1)},i.getRoomsArray=function(){for(var e=[],r=1;r<=i.form.rooms.max;r++)e.push(r);return e},i.getPricesArray=function(){for(var e=[],r=1e4;r<=i.form.price.max;r+=1e4)e.push(r);return e},i.getPriceString=function(e){return numeral(e).format("0,0")}}]);