/*
 angular-slider v1.0.0-beta.1 
 (c) 2013-2014 Venturocket, Inc. http://github.com/Venturocket 
 License: MIT 
*/
angular.module("vr.directives.slider",[]),angular.module("vr.directives.slider").directive("ngSlider",["$document","$compile","$interpolate",function(a,b,c){return{restrict:"EA",controller:"SliderCtrl",scope:!0,compile:function(d,e){if(angular.isUndefined(e.floor))throw"ngSlider Error: Floor not specified";if(angular.isUndefined(e.ceiling))throw"ngSlider Error: Ceiling not specified";return d.addClass("ng-slider"),function(d,e,f,g){function h(a,b){var c=-1*d.dimensions().sliderOffset;return c+=g.options.vertical?a.touches[b].pageY||a.pageY:a.touches[b].pageX||a.pageX}function i(a){var b=g.options.vertical?a[0].offsetTop:a[0].offsetLeft;return b-d.dimensions().sliderOffset}e.prepend(b("<ng-slider-bar low='"+c.startSymbol()+" bar.low() "+c.endSymbol()+"' high='"+c.startSymbol()+" bar.high() "+c.endSymbol()+"' ng-repeat='bar in bars'></ng-slider-bar>")(d)),d.onStart=function(a){var b=0;if(a.targetTouches&&(b=a.targetTouches[0].identifier),angular.isArray(d.currentKnobs[b])&&d.currentKnobs[b].length>1){var c=h(a,b);d.startOffsets[b]=d.currentKnobs[b].map(function(a){return i(a.elem)-c})}else d.startOffsets[b]=[0];d.onMove(a)},d.onMove=function(a){var b=d.dimensions();angular.forEach(d.currentKnobs,function(c,e){if(d.currentKnobs[e]){var f=h(a,e),i=d.startOffsets[e];angular.isArray(c)||(c=[c]);for(var j=0;j<c.length;j++){var k=g.options.vertical?c[j].elem[0].offsetHeight:c[j].elem[0].offsetWidth,l=Math.max(0,Math.min((f+i[j]-k/2)/(b.sliderSize-k),1)),m=(l*(d.ceiling-d.floor)+d.floor).toFixed(g.options.precision);c[j].ngModel.$setViewValue(m),d.$$phase||d.$apply()}}})},d.onEnd=function(a){var b=d.currentKnobs[a];delete d.currentKnobs[a],angular.isArray(b)||(b=[b]),console.log(b),angular.forEach(b,function(a){a.onEnd()}),0==d.currentKnobs.length&&(d.sliding=!1)};var j=["mousemove","touchmove"],k=["mousecancel","touchcancel"],l=["mouseup","touchend"];window.PointerEvent?(j=["pointermove"],k=["pointercancel"],l=["pointerup"]):window.navigator.msPointerEnabled&&(j=["MSPointerMove"],k=["MSPointerCancel"],l=["MSPointerUp"]),angular.forEach(j,function(b){a.bind(b,function(a){d.sliding&&(a.preventDefault(),a.stopPropagation(),d.onMove(a))})}),angular.forEach(k.concat(l),function(b){a.bind(b,function(a){if(d.sliding)if(a.changedTouches)for(var b=0;b<a.changedTouches.length;b++)d.onEnd(a.changedTouches[b].identifier);else d.onEnd(0)})}),d.$watch(function(){return d.$eval(f.ngDisabled)},function(a){d.disabled=angular.isDefined(a)&&a,d.disabled?e.addClass("disabled"):e.removeClass("disabled"),d.sliding&&angular.forEach(d.currentKnobs.keys(),function(a){d.onEnd(a)})}),f.$observe("ceiling",function(a){a=angular.isDefined(a)?parseFloat(a):0,d.ceiling=isNaN(a)?0:a}),f.$observe("floor",function(a){a=angular.isDefined(a)?parseFloat(a):0,d.floor=isNaN(a)?0:a}),d.$watch(function(){return d.$eval(f.ngSliderOptions)},function(a){angular.extend(g.options,angular.isDefined(a)&&angular.isObject(a)?a:{}),g.options.vertical?e.addClass("ng-slider-vertical").removeClass("ng-slider-horizontal"):e.addClass("ng-slider-horizontal").removeClass("ng-slider-vertical")},!0)}}}}]).directive("ngSliderKnob",["$parse","$timeout",function(a){return{restrict:"EA",require:["^ngSlider","^ngModel"],scope:!0,compile:function(b,c){if(angular.isUndefined(c.ngModel))throw"ngSliderKnob Error: ngModel not specified";return b.addClass("ng-slider-knob"),function(b,c,d,e){function f(c){a(d.ngModel).assign(b.$parent.$parent,parseFloat(c)),b.$$phase||b.$apply()}var g=e[0],h=e[1],i=!0,j=g.registerKnob({ngModel:h,elem:c,onChange:function(a){f(a),b.$viewValue=a,c.css(g.options.vertical?"top":"left",g.valueToPercent(a,c)+"%")},onStart:function(){c.addClass("active")},onEnd:function(){c.removeClass("active")}});b.$watch(function(){return b.$eval(d.ngDisabled)},function(a){i=!a,a?c.addClass("disabled"):c.removeClass("disabled"),j.disabled()});var k=["mousedown","touchstart"];window.PointerEvent?k=["pointerdown"]:window.navigator.MSPointerEnabled&&(k=["MSPointerDown"]),angular.forEach(k,function(a){c.bind(a,function(a){a.preventDefault(),a.stopPropagation(),j.start(a)})})}}}}]).directive("ngSliderBar",function(){return{restrict:"EA",require:"^ngSlider",compile:function(a){return a.addClass("ng-slider-bar"),function(a,b,c,d){function e(){var c=d.valueToPercent(a.low,a.lowKnob?a.lowKnob.elem:null,!0),e=d.valueToPercent(a.high,a.highKnob?a.highKnob.elem:null,!0)-c;b.css(d.options.vertical?"top":"left",c+"%"),b.css(d.options.vertical?"height":"width",e+"%")}a.low=0,a.high=0,a.lowKnob=null,a.highKnob=null;var f=d.registerBar({elem:b,scope:a,onStart:function(){b.addClass("active")},onChange:function(){e()},onEnd:function(){b.removeClass("active")}});c.$observe("low",function(b){a.low=b,e()}),c.$observe("high",function(b){a.high=b,e()});var g=["mousedown","touchstart"];window.PointerEvent?g=["pointerdown"]:window.navigator.MSPointerEnabled&&(g=["MSPointerDown"]),angular.forEach(g,function(a){b.bind(a,function(a){a.preventDefault(),a.stopPropagation(),f.start(a)})})}}}}),angular.module("vr.directives.slider").controller("SliderCtrl",["$scope","$element",function(a,b){function c(){a.knobs.sort(function(a,b){var c=a.ngModel.$modelValue,d=b.ngModel.$modelValue;return c>d?1:d>c?-1:0})}function d(){a.bars.push({low:function(){return 0},high:function(){return 0}})}function e(){a.bars.splice(0,1)}function f(){function b(b){return function(){return b>0?a.knobs[b-1].ngModel.$modelValue:a.floor}}function c(b){return function(){return b<a.knobs.length?a.knobs[b].ngModel.$modelValue:a.ceiling}}for(var f=a.knobs.length;a.bars.length<f+1;)d();for(;a.bars.length>f+1;)e();angular.forEach(a.bars,function(a,d){a.low=b(d),a.high=c(d)}),angular.forEach(g,function(b,c){b.scope.lowKnob=c>0?a.knobs[c-1]:null,b.scope.highKnob=c<a.knobs.length?a.knobs[c]:null,b.onChange&&b.onChange()})}a.knobs=[],a.bars=[];var g=[];a.currentKnobs=[],a.startOffsets=[],a.sliding=!1,this.options={precision:0,buffer:0,steps:0,addStepNumbers:!1,stickiness:3,scale:function(a){return a},continuous:!1,vertical:!1};var h=this.options;a.dimensions=function(){var a=h.vertical?b[0].offsetTop:b[0].offsetLeft;return b[0].offsetParent&&(a+=h.vertical?b[0].offsetParent.offsetTop:b[0].offsetParent.offsetLeft),{sliderSize:h.vertical?b[0].offsetHeight:b[0].offsetWidth,sliderOffset:a}},a.fix=function(){c(),f()},this.valueToPercent=function(b,c,d){var e=0;c&&(e=this.options.vertical?c[0].offsetHeight:c[0].offsetWidth);var f=e/a.dimensions().sliderSize*100,g=(parseFloat(b)-a.floor)/(a.ceiling-a.floor)*(100-f);return d&&c&&(g+=f/2),g},this.registerKnob=function(b){function c(c){var d=a.ceiling,e=a.floor,f=parseFloat(c),g=a.knobs.indexOf(b);if(h.continuous||(g>0&&(e=parseFloat(a.knobs[g-1].ngModel.$modelValue)+(h.buffer>0?h.buffer:0)),g<a.knobs.length-1&&(d=parseFloat(a.knobs[g+1].ngModel.$modelValue)-(h.buffer>0?h.buffer:0))),h.steps>1){var i=(a.ceiling-a.floor)/(h.steps-1);if(g>0){var j=(e-a.floor)%i;j>0&&(e+=i-j)}if(g<a.knobs.length-1){var k=(d-a.floor)%i;k>0&&(d-=k)}var l=(f-a.floor)%i;i/2>l?f-=l:f+=i-l}f=Math.min(d,Math.max(f,e)),h.precision>=0&&(f=parseFloat(f.toFixed(h.precision))),f===c?b.onChange&&b.onChange(c):isNaN(f)||(b.ngModel.$setViewValue(f),a.$$phase||a.$apply())}function d(b){e&&(c(b),a.fix(),a.$$phase||a.$apply())}var e=!0;return a.knobs.push(b),a.$watch(function(){return b.ngModel.$modelValue},function(a){d(a)}),a.$watch("floor",function(){d(b.ngModel.$modelValue)}),a.$watch("ceiling",function(){d(b.ngModel.$modelValue)}),a.$watch(function(){return h},function(){d(b.ngModel.$modelValue)},!0),f(),b.elem.on("$destroy",function(){a.knobs.splice(a.knobs.indexOf(b),1),e=!1}),{start:function(c){a.disabled||(angular.isDefined(c.targetTouches)?a.currentKnobs[c.targetTouches[0].identifier]=[b]:a.currentKnobs[0]=[b],a.sliding=!0,a.onStart(c),b.onStart())},disabled:function(){var c=a.currentKnobs.indexOf(b);a.sliding&&c>=0&&a.onEnd(c)}}},this.registerBar=function(b){return g.push(b),b.elem.on("$destroy",function(){var a=g.indexOf(b);a>=0&&g.splice(a,1)}),{start:function(c){if(!a.disabled){var d=[];b.scope.lowKnob&&d.push(b.scope.lowKnob),b.scope.highKnob&&d.push(b.scope.highKnob),angular.isDefined(c.targetTouches)?a.currentKnobs[c.targetTouches[0].identifier]=d:a.currentKnobs[0]=d,a.sliding=!0,a.onStart(c),b.onStart()}}}}}]);